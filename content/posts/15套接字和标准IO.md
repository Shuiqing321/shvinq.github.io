---
title: "15套接字与标准IO函数"
date: "2021-08-20T02:20:04+08:00"
tags:
categories: ["网络编程"]
showToc: true
TocOpen: false
draft: false
hidemeta: false
comments: false
disableHLJS: true
disableShare: false
disableHLJS: false
hideSummary: false
searchHidden: true
ShowReadingTime: false
ShowBreadCrumbs: true
ShowPostNavLinks: true
---

### 标准IO函数的优点

- 标准I/O函数具有良好的可移植性(Portability)
- 标准I/O函数可以利用缓冲提高性能

创建套接字时，操作系统将会生成用于IO的缓冲，该缓冲在执行TCP协议时发挥作用。此时若使用标准IO函数，将得到另一缓冲支持。例如fputs传输字符串时，数据先到IO函数缓冲然后移动到套接字缓冲最后发给对端主机。

![](https://i.loli.net/2019/01/29/5c500e53ad9aa.png)

两个缓冲有各自的用途，设置缓冲的主要目的是为了提高性能，但套接字中的缓冲是为了实现TCP协议而设立，例如TCP传输中丢失数据时将再次传递，说明再次传递的数据存在套接字缓冲中。标准IO函数缓冲主要时用于提高性能。但是提高的性能更传输的数据成正比，要传输的越多，提升就越显著。

- 传输的数据量
- 数据向输出缓冲移动的次数

例如一个10字节数据一次发1字节和累计10字节发一次。另外为了发送数据IO函数缓冲向套接字缓冲移动也有消耗。

### 标准IO函数的缺点

- 不容易进行双向通信
- 有时可能频繁调用fflush函数
- 需要以FILE结构体指针的形式返回文件描述符

### 使用标准IO函数

**利用fdopen函数转换为FILE结构体指针**

```c
#include <stdio.h>
FILE * fdopen(int filedes, const char * mode);//成功返回转换的FILE结构体指针，失败返回NULL
/*
filedes: 需要转换的文件描述符 
mode: 将要创建的FILE结构体指针的模式信息
*/
```

**利用fileno函数转换为文件描述符**

```c
#include <stdio.h>
int * fileno(FILE * stream);//成功返回转换的文件描述符，失败返回-1
```
